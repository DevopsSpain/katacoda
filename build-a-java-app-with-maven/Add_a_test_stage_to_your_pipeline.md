=== Add a test stage to your Pipeline

. Go back to your text editor/IDE and ensure your `Jenkinsfile` is open.
. Copy and paste the following Declarative Pipeline syntax immediately under the
  `Build` stage of your `Jenkinsfile`:
+
[source,groovy]
----
        stage('Test') {
            steps {
                sh 'mvn test'
            }
            post {
                always {
                    junit 'target/surefire-reports/*.xml'
                }
            }
        }
----
so that you end up with:
+
[source,groovy]
----
pipeline {
    agent {
        docker {
            image 'maven:3-alpine'
            args '-v /root/.m2:/root/.m2'
        }
    }
    stages {
        stage('Build') {
            steps {
                sh 'mvn -B -DskipTests clean package'
            }
        }
        stage('Test') { // <1>
            steps {
                sh 'mvn test' // <2>
            }
            post {
                always {
                    junit 'target/surefire-reports/*.xml' // <3>
                }
            }
        }
    }
}
----
<1> Defines a https://jenkins.io/doc/book/pipeline/syntax/#stage[`stage`] (directive) called
`Test` that appears on the Jenkins UI.
<2> This
link:/doc/pipeline/steps/workflow-durable-task-step/#code-sh-code-shell-script[`sh`]
step (of the link:/doc/book/pipeline/syntax/#steps[`steps`] section) executes
the Maven command to run the unit test on your simple Java application. This
command also generates a JUnit XML report, which is saved to the
`target/surefire-reports` directory (within the
`/var/jenkins_home/workspace/simple-java-maven-app` directory in the Jenkins
container).
<3> This
link:/doc/pipeline/steps/junit/#code-junit-code-archive-junit-formatted-test-results[`junit`]
step (provided by the link:/doc/pipeline/steps/junit[JUnit Plugin]) archives the
JUnit XML report (generated by the `mvn test` command above) and exposes the
results through the Jenkins interface. In Blue Ocean, the results are accessible
through the *Tests* page of a Pipeline run. The
link:/doc/book/pipeline/syntax/#post[`post`] section's `always` condition that
contains this `junit` step ensures that the step is _always_ executed _at the
completion_ of the `Test` stage, regardless of the stage's outcome.
. Save your edited `Jenkinsfile` and commit it to your local
  `simple-java-maven-app` Git repository. E.g. Within the
  `simple-java-maven-app` directory, run the commands: +
  `git stage .` +
  then +
  `git commit -m "Add 'Test' stage"`
. Go back to Jenkins again, log in again if necessary and ensure you've accessed
  Jenkins's Blue Ocean interface.
. Click *Run* at the top left, then quickly click the *OPEN* link which appears
  briefly at the lower-right to see Jenkins running your amended Pipeline
  project. If you weren't able to click the **OPEN** link, click the _top_ row
  on the Blue Ocean interface to access this feature. +
  *Note:* You'll notice from this run that Jenkins no longer needs to download
  the Maven Docker image. Instead, Jenkins only needs to run a new container
  from the Maven image downloaded previously. Also, if Docker had not restarted
  since you last ran the Pipeline <<create-your-initial-pipeline-as-a-jenkinsfile,above>>,
  then no Maven artifacts need to be downloaded during the "Build" stage.
  Therefore, running your Pipeline this subsequent time should be much faster. +
  If your amended Pipeline ran successfully, here's what the Blue Ocean
  interface should look like. Notice the additional "Test" stage. You can click
  on the previous "Build" stage circle to access the output from that stage.
[.boxshadow]
image:tutorials/java-maven-11-test-stage-runs-successfully-with-output.png[alt="Test
stage runs successfully (with output)",width=100%]
. Click the *X* at the top-right to return to the main Blue Ocean interface.
